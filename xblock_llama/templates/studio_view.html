<div class="studio-llama-xblock">
    <label for="display_name">Display Name:</label>
    <input type="text" id="display_name" value="{display_name}">
    <button id="save-display-name">Save</button>
    <span id="save-status"></span> 

    <label for="deepseek_api_key">DeepSeek API Key:</label>
    <input type="text" id="deepseek_api_key" value="{deepseek_api_key}">
    <button id="save-deepseek-api-key">Save</button>
    <span id="save-deepseek-api-key-status"></span>

    <label for="model_type">Model Type:</label>
    <!-- 
    <select id="model_type">
        <option value="llama" {% if model_type == 'llama' %}selected{% endif %}>Llama</option>
        <option value="deepseek" {% if model_type == 'deepseek' %}selected{% endif %}>DeepSeek (DeepSeek API)</option>
        <option value="deepseek-r1:1.5b" {% if model_type == 'deepseek-r1:1.5b' %}selected{% endif %}>DeepSeek-r1:1.5b (Ollama)</option>
    </select>
    -->
    <label for="model-type">Model:</label>
    <select id="model-type">
        <option value="llama">Llama</option>
        <option value="deepseek">DeepSeek (DeepSeek API)</option>
        <option value="deepseek-r1:1.5b">DeepSeek-r1:1.5b (Ollama)</option>
    </select>

    <button id="save-model-type">Save</button>
    <span id="save-model-type-status"></span>
</div>
<script>
    function LlamaXBlock(runtime, element) {
        $('#save-display-name').click(function () {
            var display_name = $('#display_name').val();
            $('#save-status').text("Saving..."); // 显示保存状态

            $.ajax({
                type: "POST",
                url: runtime.handlerUrl(element, 'save_display_name'),
                data: JSON.stringify({ 'display_name': display_name }),
                contentType: "application/json",
                dataType: "json",
                success: function (data) {
                    if (data.success) {
                        $('#save-status').text("Saved!");
                    } else {
                        $('#save-status').text("Error: " + data.message);
                    }
                },
                error: function (error) {
                    console.error("Error:", error);
                    $('#save-status').text("Error: Could not save.");
                },
                complete: function() {
                    setTimeout(function(){ $('#save-status').text("") }, 3000); // 3秒后清除提示信息
                }
            });
        });

        $('#save-deepseek-api-key').click(function () {
            var deepseek_api_key = $('#deepseek_api_key').val();
            $('#save-deepseek-api-key-status').text("Saving...");

            $.ajax({
                type: "POST",
                url: runtime.handlerUrl(element, 'save_deepseek_api_key'),
                data: JSON.stringify({ 'deepseek_api_key': deepseek_api_key }),
                contentType: "application/json",
                dataType: "json",
                success: function (data) {
                    if (data.success) {
                        $('#save-deepseek-api-key-status').text("Saved!");
                    } else {
                        $('#save-deepseek-api-key-status').text("Error: " + data.message);
                    }
                },
                error: function (error) {
                    console.error("Error:", error);
                    $('#save-deepseek-api-key-status').text("Error: Could not save.");
                },
                complete: function() {
                    setTimeout(function(){ $('#save-deepseek-api-key-status').text("") }, 3000); // 3秒后清除提示信息
                }
            });
        });

        $('#save-model-type').click(function () {
            var modelType = $('#model_type').val();
            $('#save-model-type-status').text("Saving...");

            $.ajax({
                type: "POST",
                url: runtime.handlerUrl(element, 'save_model_type'),
                data: JSON.stringify({ 'model_type': modelType }),
                contentType: "application/json",
                dataType: "json",
                success: function (data) {
                    if (data.success) {
                        $('#save-model-type-status').text("Saved!");
                    } else {
                        $('#save-model-type-status').text("Error: " + data.message);
                    }
                },
                error: function (error) {
                    console.error("Error:", error);
                    $('#save-model-type-status').text("Error: Could not save.");
                },
                complete: function() {
                    setTimeout(function(){ $('#save-model-type-status').text("") }, 3000); // 3秒后清除提示信息
                }
            });
        });
    }

    function js_init_fn(runtime, element) {
        return new LlamaXBlock(runtime, element);
    }

    $(function () {
        runtime.register('LlamaXBlock', js_init_fn);
        // runtime.register('llama', js_init_fn);
    });
    
</script>